<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playback Aleatório Musical</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #fdbb2d;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .loading-progress {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            transition: width 0.5s;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn.active {
            background: linear-gradient(135deg, #fdbb2d, #b21f1f);
        }
        
        .btn.toggle {
            background: linear-gradient(135deg, #333, #555);
        }
        
        .btn.toggle.active {
            background: linear-gradient(135deg, #1a2a6c, #2980b9);
        }
        
        .status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-label {
            font-size: 14px;
            color: #fdbb2d;
        }
        
        .status-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .bpm-control {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
        }
        
        .bpm-control button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            margin: 0 10px;
        }
        
        .bpm-display {
            font-size: 28px;
            font-weight: bold;
            margin: 0 15px;
            min-width: 80px;
            text-align: center;
        }
        
        .editor {
            margin-top: 20px;
        }
        
        .editor h3 {
            margin-bottom: 10px;
            color: #fdbb2d;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            border-radius: 5px;
            color: white;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .instrument-name {
            font-weight: bold;
            color: #fdbb2d;
            margin-top: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .chord-display {
            font-size: 32px;
            text-align: center;
            margin: 20px 0;
            height: 50px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            color: #fdbb2d;
        }
        
        .key-display {
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Playback Aleatório Musical</h1>
        
        <div id="loading" class="loading">
            <p>Carregando arquivos de áudio...</p>
            <p>Clique para iniciar o carregamento</p>
            <div class="loading-progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <button class="btn" id="startLoading" style="margin-top: 20px;">Iniciar Carregamento</button>
        </div>
        
        <div id="mainContent" class="hidden">
            <div class="key-display">
                Campo Harmônico: <span id="currentKey">C Maior</span>
            </div>
            
            <div class="chord-display" id="chordDisplay">
                A
            </div>
            
            <div class="status">
                <div class="status-item">
                    <div class="status-label">BPM</div>
                    <div class="status-value" id="bpmValue">120</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Compasso</div>
                    <div class="status-value" id="measureCount">1</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Estado</div>
                    <div class="status-value" id="playbackState">Parado</div>
                </div>
            </div>
            
            <div class="bpm-control">
                <button class="btn" id="bpmDown">-</button>
                <div class="bpm-display" id="bpmDisplay">120</div>
                <button class="btn" id="bpmUp">+</button>
            </div>
            
            <div class="controls">
                <button class="btn" id="playBtn">Play</button>
                <button class="btn" id="pauseBtn">Pause</button>
                <button class="btn" id="stopBtn">Parar</button>
                <button class="btn" id="saveBtn">Salvar</button>
                <button class="btn" id="backBtn">Voltar</button>
                <button class="btn" id="repeatBtn">Repetir</button>
            </div>
            
            <div class="controls">
                <button class="btn toggle" id="bassToggle">Baixo: Ativado</button>
                <button class="btn toggle" id="drumsToggle">Bateria: Ativado</button>
                <button class="btn toggle" id="distGuitarToggle">Guitarra Dist: Ativado</button>
                <button class="btn toggle" id="cleanGuitarToggle">Guitarra Limpa: Ativado</button>
            </div>
            
            <div class="editor">
                <h3>Editor de Levadas</h3>
                <div class="instrument-name">Bateria:</div>
                <textarea id="drumsPattern">
[ca ca ca - ba - - - ca - ca - to1 - to2-]
(ba - ch bu cch - ch - bch - ch - cch - ch -,
bch - ch bu cch - ch - bch - ch - cch - ch -, 
bch - ch bu cch - ch - bch - ch - cch - ch -,
bch - ch bu cch - ch - bch - ch - cch - ch -)
                </textarea>
                
                <div class="instrument-name">Baixo:</div>
                <textarea id="bassPattern">
[sc sc c sm cc cc]
(c c c c c c c c,
sc sc sc sc cc sc sc sc sc ca,
sb,
c c c c c c c c)
                </textarea>
                
                <button class="btn" id="applyPatterns">Aplicar Padrões</button>
            </div>
        </div>
    </div>

    <script>
        // Variáveis globais
        let audioContext;
        let isLoading = false;
        let isPlaying = false;
        let currentBPM = 120;
        let measureCount = 0;
        let currentChord = "A";
        let currentKey = "C Maior";
        
        // Elementos DOM
        const loadingElement = document.getElementById('loading');
        const mainContentElement = document.getElementById('mainContent');
        const progressBarElement = document.getElementById('progressBar');
        const startLoadingButton = document.getElementById('startLoading');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const saveBtn = document.getElementById('saveBtn');
        const backBtn = document.getElementById('backBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const bassToggle = document.getElementById('bassToggle');
        const drumsToggle = document.getElementById('drumsToggle');
        const distGuitarToggle = document.getElementById('distGuitarToggle');
        const cleanGuitarToggle = document.getElementById('cleanGuitarToggle');
        const bpmDisplay = document.getElementById('bpmDisplay');
        const bpmValue = document.getElementById('bpmValue');
        const bpmUp = document.getElementById('bpmUp');
        const bpmDown = document.getElementById('bpmDown');
        const chordDisplay = document.getElementById('chordDisplay');
        const measureCountElement = document.getElementById('measureCount');
        const playbackStateElement = document.getElementById('playbackState');
        const currentKeyElement = document.getElementById('currentKey');
        const drumsPatternElement = document.getElementById('drumsPattern');
        const bassPatternElement = document.getElementById('bassPattern');
        const applyPatternsButton = document.getElementById('applyPatterns');
        
        // Event Listeners
        startLoadingButton.addEventListener('click', startLoading);
        playBtn.addEventListener('click', togglePlay);
        pauseBtn.addEventListener('click', togglePause);
        stopBtn.addEventListener('click', stopPlayback);
        saveBtn.addEventListener('click', savePlayback);
        backBtn.addEventListener('click', goBack);
        repeatBtn.addEventListener('click', repeatPlayback);
        bassToggle.addEventListener('click', () => toggleInstrument(bassToggle, 'bass'));
        drumsToggle.addEventListener('click', () => toggleInstrument(drumsToggle, 'drums'));
        distGuitarToggle.addEventListener('click', () => toggleInstrument(distGuitarToggle, 'distGuitar'));
        cleanGuitarToggle.addEventListener('click', () => toggleInstrument(cleanGuitarToggle, 'cleanGuitar'));
        bpmUp.addEventListener('click', () => changeBPM(5));
        bpmDown.addEventListener('click', () => changeBPM(-5));
        applyPatternsButton.addEventListener('click', applyPatterns);
        
        // Iniciar carregamento
        function startLoading() {
            if (isLoading) return;
            
            isLoading = true;
            startLoadingButton.disabled = true;
            
            // Simular carregamento progressivo
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                progressBarElement.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingElement.classList.add('hidden');
                        mainContentElement.classList.remove('hidden');
                        initializeAudioContext();
                    }, 500);
                }
            }, 200);
        }
        
        // Inicializar contexto de áudio
        function initializeAudioContext() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log("Contexto de áudio inicializado");
            } catch (e) {
                alert("Seu navegador não suporta Web Audio API. Por favor, use um navegador moderno.");
                console.error(e);
            }
        }
        
        // Alternar reprodução
        function togglePlay() {
            if (!isPlaying) {
                isPlaying = true;
                playbackStateElement.textContent = "Tocando";
                playBtn.textContent = "Playing";
                simulatePlayback();
            } else {
                togglePause();
            }
        }
        
        // Alternar pausa
        function togglePause() {
            isPlaying = !isPlaying;
            if (isPlaying) {
                playbackStateElement.textContent = "Tocando";
                playBtn.textContent = "Playing";
            } else {
                playbackStateElement.textContent = "Pausado";
                playBtn.textContent = "Play";
            }
        }
        
        // Parar reprodução
        function stopPlayback() {
            isPlaying = false;
            measureCount = 0;
            measureCountElement.textContent = measureCount;
            playbackStateElement.textContent = "Parado";
            playBtn.textContent = "Play";
            
            // Sortear novo campo harmônico
            const keys = [
                "C Maior", "C# Maior", "Db Maior", "D Maior", "Eb Maior", 
                "E Maior", "F Maior", "F# Maior", "Gb Maior", "G Maior", 
                "Ab Maior", "A Maior", "Bb Maior", "B Maior"
            ];
            currentKey = keys[Math.floor(Math.random() * keys.length)];
            currentKeyElement.textContent = currentKey;
            
            // Sortear novo acorde
            const chords = ["A", "Am", "B", "Bm", "C", "Cm", "D", "Dm", "E", "Em", "F", "Fm", "G", "Gm"];
            currentChord = chords[Math.floor(Math.random() * chords.length)];
            chordDisplay.textContent = currentChord;
        }
        
        // Salvar playback (simulado)
        function savePlayback() {
            alert("Funcionalidade de salvar seria implementada aqui. Geraria um MP5 de 5 minutos do playback atual.");
        }
        
        // Voltar para o playback anterior
        function goBack() {
            alert("Voltando para o playback anterior");
            stopPlayback();
        }
        
        // Repetir playback
        function repeatPlayback() {
            alert("Repetindo a partir da introdução");
            stopPlayback();
            togglePlay();
        }
        
        // Alternar instrumento
        function toggleInstrument(button, instrument) {
            button.classList.toggle('active');
            const isActive = button.classList.contains('active');
            button.textContent = `${button.textContent.split(':')[0]}: ${isActive ? 'Ativado' : 'Desativado'}`;
            console.log(`${instrument} ${isActive ? 'ativado' : 'desativado'}`);
        }
        
        // Alterar BPM
        function changeBPM(delta) {
            currentBPM += delta;
            if (currentBPM < 60) currentBPM = 60;
            if (currentBPM > 200) currentBPM = 200;
            
            bpmDisplay.textContent = currentBPM;
            bpmValue.textContent = currentBPM;
        }
        
        // Aplicar padrões editados
        function applyPatterns() {
            const drumsPattern = drumsPatternElement.value;
            const bassPattern = bassPatternElement.value;
            alert("Padrões aplicados com sucesso!\nBateria: " + drumsPattern.substring(0, 50) + "...\nBaixo: " + bassPattern.substring(0, 50) + "...");
        }
        
        // Simular playback (em um caso real, isso tocaria os áudios)
        function simulatePlayback() {
            if (!isPlaying) return;
            
            // Simular mudança de acorde a cada 4 compassos
            if (measureCount % 4 === 0) {
                const chords = ["A", "Am", "B", "Bm", "C", "Cm", "D", "Dm", "E", "Em", "F", "Fm", "G", "Gm"];
                currentChord = chords[Math.floor(Math.random() * chords.length)];
                chordDisplay.textContent = currentChord;
            }
            
            measureCount++;
            measureCountElement.textContent = measureCount;
            
            // Continuar simulação
            setTimeout(simulatePlayback, (60000 / currentBPM) * 4); // Intervalo baseado no BPM
        }
        
        // Inicializar estado dos botões de toggle
        bassToggle.classList.add('active');
        drumsToggle.classList.add('active');
        distGuitarToggle.classList.add('active');
        cleanGuitarToggle.classList.add('active');
        
        // Sortear campo harmônico inicial
        const keys = [
            "C Maior", "C# Maior", "Db Maior", "D Maior", "Eb Maior", 
            "E Maior", "F Maior", "F# Maior", "Gb Maior", "G Maior", 
            "Ab Maior", "A Maior", "Bb Maior", "B Maior"
        ];
        currentKey = keys[Math.floor(Math.random() * keys.length)];
        currentKeyElement.textContent = currentKey;
    </script>
</body>
</html>